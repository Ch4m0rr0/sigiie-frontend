<div class="min-h-screen bg-slate-50/50 p-6 lg:p-8 font-sans text-slate-900">
  
  <div class="mb-8 animate-fade-in">
    <div class="flex items-center gap-3 mb-2">
      <button 
        (click)="cancel()"
        class="p-2 -ml-2 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-full transition-colors">
        <app-icon icon="arrow_back" size="sm"></app-icon>
      </button>
      <h1 class="text-2xl font-bold text-slate-900 tracking-tight">
        @if (isEditMode()) {
          Editar Proyecto
        } @else if (tipoProyecto() === 'planificado') {
          Nuevo Proyecto Planificado
        } @else if (tipoProyecto() === 'no-planificado') {
          Nuevo Proyecto No Planificado
        } @else {
          Nuevo Proyecto
        }
      </h1>
    </div>
    <p class="text-slate-500 text-sm ml-10">
      @if (isEditMode()) {
        Modifica la información del proyecto
      } @else if (tipoProyecto() === 'planificado') {
        Completa el formulario para crear un nuevo proyecto planificado
      } @else if (tipoProyecto() === 'no-planificado') {
        Completa el formulario para crear un nuevo proyecto no planificado
      } @else {
        Completa el formulario para crear un nuevo proyecto
      }
    </p>
  </div>

  @if (loading()) {
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-8 animate-pulse">
      <div class="space-y-4">
        <div class="h-4 bg-slate-200 rounded w-3/4"></div>
        <div class="h-4 bg-slate-200 rounded w-1/2"></div>
        <div class="h-32 bg-slate-200 rounded"></div>
      </div>
    </div>
  }

  @if (!loading()) {
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="bg-white rounded-xl shadow-sm border border-slate-200" style="position: relative;">
      
      <!-- Alertas -->
      @if (error()) {
        <div class="p-6 pb-0">
          <div class="bg-red-50 border-2 border-red-200 rounded-xl p-4 flex items-start gap-3">
            <app-icon icon="error_outline" size="md" class="text-red-600 mt-0.5"></app-icon>
            <div>
              <h3 class="text-sm font-bold text-red-800">Error</h3>
              <p class="text-sm text-red-600 mt-1">{{ error() }}</p>
            </div>
          </div>
        </div>
      }

      @if (success()) {
        <div class="p-6 pb-0">
          <div class="bg-emerald-50 border-2 border-emerald-200 rounded-xl p-4 flex items-start gap-3">
            <app-icon icon="check_circle" size="md" class="text-emerald-600 mt-0.5"></app-icon>
            <div>
              <h3 class="text-sm font-bold text-emerald-800">Éxito</h3>
              <p class="text-sm text-emerald-600 mt-1">{{ success() }}</p>
            </div>
          </div>
        </div>
      }

      <div class="p-6 md:p-8 space-y-6" style="position: relative;">
        
        <!-- Sección 1: Información General -->
        <div class="border border-slate-200 rounded-lg overflow-hidden">
          <!-- Header del acordeón -->
          <button
            type="button"
            (click)="toggleSeccionInformacion()"
            class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-emerald-50 to-white hover:from-emerald-100 hover:to-emerald-50 transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <app-icon icon="info" size="sm"></app-icon>
              </div>
              <div class="text-left">
                <h3 class="text-base font-bold text-slate-900">Información General</h3>
                <p class="text-xs text-slate-500 mt-0.5">Datos básicos del proyecto</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs font-medium" [class.text-emerald-600]="seccionInformacionExpandida()" [class.text-slate-400]="!seccionInformacionExpandida()">
                {{ seccionInformacionExpandida() ? 'Abierta' : 'Cerrada' }}
              </span>
              <app-icon 
                [icon]="seccionInformacionExpandida() ? 'keyboard_arrow_up' : 'keyboard_arrow_down'" 
                size="md" 
                class="transition-all duration-200"
                [class.text-emerald-600]="seccionInformacionExpandida()"
                [class.text-slate-400]="!seccionInformacionExpandida()"></app-icon>
            </div>
          </button>
          
          <!-- Contenido del acordeón -->
          @if (seccionInformacionExpandida()) {
            <div class="p-6 space-y-6 border-t border-slate-200 animate-fade-in">
              <!-- Nombre -->
              <div>
                <label for="nombreProyecto" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                  <app-icon icon="title" size="xs" class="text-emerald-600"></app-icon>
                  Nombre del Proyecto <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <input
                    id="nombreProyecto"
                    type="text"
                    formControlName="nombreProyecto"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                    [class.border-red-500]="form.get('nombreProyecto')?.invalid && form.get('nombreProyecto')?.touched"
                    placeholder="Nombre del proyecto"
                    required
                  />
                  @if (form.get('nombreProyecto')?.valid && form.get('nombreProyecto')?.touched) {
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-emerald-600">
                      <app-icon icon="check_circle" size="xs"></app-icon>
                    </span>
                  }
                </div>
                @if (form.get('nombreProyecto')?.invalid && form.get('nombreProyecto')?.touched) {
                  <p class="mt-1.5 text-sm text-red-600">{{ getFieldError('nombreProyecto') }}</p>
                }
              </div>

              <!-- Descripción -->
              <div>
                <label for="descripcion" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                  <app-icon icon="description" size="xs" class="text-emerald-600"></app-icon>
                  Descripción
                </label>
                <textarea
                  id="descripcion"
                  formControlName="descripcion"
                  rows="4"
                  class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all resize-none"
                  placeholder="Describe el proyecto..."
                ></textarea>
              </div>

              <!-- Estado y Tipo Autor -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="idEstadoProyecto" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="toggle_on" size="xs" class="text-emerald-600"></app-icon>
                    Estado del Proyecto
                  </label>
                  <select
                    id="idEstadoProyecto"
                    formControlName="idEstadoProyecto"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar estado</option>
                    @for (estado of estadosProyecto(); track estado.id) {
                      <option [ngValue]="estado.id">{{ estado.nombre }}</option>
                    }
                  </select>
                </div>

                <div>
                  <label for="tipoAutor" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="person" size="xs" class="text-emerald-600"></app-icon>
                    Tipo de Autor
                  </label>
                  <input
                    id="tipoAutor"
                    type="text"
                    formControlName="tipoAutor"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 placeholder-slate-400 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                    placeholder="Tipo de autor"
                  />
                </div>
              </div>

              <!-- Fechas -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="fechaInicio" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="event" size="xs" class="text-emerald-600"></app-icon>
                    Fecha de Inicio
                  </label>
                  <input
                    id="fechaInicio"
                    type="date"
                    formControlName="fechaInicio"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all disabled:bg-slate-50 disabled:text-slate-500 disabled:cursor-not-allowed"
                  />
                </div>

                <div>
                  <label for="fechaFin" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="event_busy" size="xs" class="text-emerald-600"></app-icon>
                    Fecha de Fin
                  </label>
                  <input
                    id="fechaFin"
                    type="date"
                    formControlName="fechaFin"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all disabled:bg-slate-50 disabled:text-slate-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Sección 2: Clasificación -->
        <div class="border border-slate-200 rounded-lg overflow-hidden">
          <!-- Header del acordeón -->
          <button
            type="button"
            (click)="toggleSeccionClasificacion()"
            class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-emerald-50 to-white hover:from-emerald-100 hover:to-emerald-50 transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <app-icon icon="category" size="sm"></app-icon>
              </div>
              <div class="text-left">
                <h3 class="text-base font-bold text-slate-900">Clasificación</h3>
                <p class="text-xs text-slate-500 mt-0.5">Departamento, edición y categorías</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs font-medium" [class.text-emerald-600]="seccionClasificacionExpandida()" [class.text-slate-400]="!seccionClasificacionExpandida()">
                {{ seccionClasificacionExpandida() ? 'Abierta' : 'Cerrada' }}
              </span>
              <app-icon 
                [icon]="seccionClasificacionExpandida() ? 'keyboard_arrow_up' : 'keyboard_arrow_down'" 
                size="md" 
                class="transition-all duration-200"
                [class.text-emerald-600]="seccionClasificacionExpandida()"
                [class.text-slate-400]="!seccionClasificacionExpandida()"></app-icon>
            </div>
          </button>
          
          <!-- Contenido del acordeón -->
          @if (seccionClasificacionExpandida()) {
            <div class="p-6 space-y-6 border-t border-slate-200 animate-fade-in">
              <!-- Departamento y Edición -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="departamentoId" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="business" size="xs" class="text-emerald-600"></app-icon>
                    Departamento
                  </label>
                  <select
                    id="departamentoId"
                    formControlName="departamentoId"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar departamento</option>
                    @for (dept of departamentos(); track dept.id) {
                      <option [ngValue]="dept.id">{{ dept.nombre }}</option>
                    }
                  </select>
                </div>

                <div>
                  <label for="idEdicion" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="calendar_today" size="xs" class="text-emerald-600"></app-icon>
                    Edición
                  </label>
                  <select
                    id="idEdicion"
                    formControlName="idEdicion"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar edición (opcional)</option>
                    @for (edicion of ediciones(); track edicion.id) {
                      <option [ngValue]="edicion.id">
                        {{ edicion.nombreActividad || 'Edición' }} - {{ edicion.anio }}
                      </option>
                    }
                  </select>
                  <p class="mt-1.5 text-xs text-slate-500">Si se especifica, las fechas se tomarán de la edición</p>
                </div>
              </div>

              <!-- Tipos y Áreas -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="idTipoIniciativa" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="lightbulb" size="xs" class="text-emerald-600"></app-icon>
                    Tipo de Iniciativa
                  </label>
                  <select
                    id="idTipoIniciativa"
                    formControlName="idTipoIniciativa"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar tipo de iniciativa</option>
                    @for (tipo of tiposIniciativa(); track tipo.id) {
                      <option [ngValue]="tipo.id">{{ tipo.nombre }}</option>
                    }
                  </select>
                </div>

                <div>
                  <label for="idTipoInvestigacion" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="science" size="xs" class="text-emerald-600"></app-icon>
                    Tipo de Investigación
                  </label>
                  <select
                    id="idTipoInvestigacion"
                    formControlName="idTipoInvestigacion"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar tipo de investigación</option>
                    @for (tipo of tiposInvestigacion(); track tipo.id) {
                      <option [ngValue]="tipo.id">{{ tipo.nombre }}</option>
                    }
                  </select>
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="idAreaConocimiento" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="school" size="xs" class="text-emerald-600"></app-icon>
                    Área de Conocimiento
                  </label>
                  <select
                    id="idAreaConocimiento"
                    formControlName="idAreaConocimiento"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar área de conocimiento</option>
                    @for (area of areasConocimiento(); track area.id) {
                      <option [ngValue]="area.id">{{ area.nombre }}</option>
                    }
                  </select>
                </div>

                <div>
                  <label for="idTipoDocumento" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                    <app-icon icon="description" size="xs" class="text-emerald-600"></app-icon>
                    Tipo de Documento
                  </label>
                  <select
                    id="idTipoDocumento"
                    formControlName="idTipoDocumento"
                    class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  >
                    <option [ngValue]="null">Seleccionar tipo de documento</option>
                    @for (tipo of tiposDocumento(); track tipo.id) {
                      <option [ngValue]="tipo.id">{{ tipo.nombre }}</option>
                    }
                  </select>
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Sección 3: Participantes -->
        <div class="border border-slate-200 rounded-lg overflow-hidden">
          <!-- Header del acordeón -->
          <button
            type="button"
            (click)="toggleSeccionParticipantes()"
            class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-emerald-50 to-white hover:from-emerald-100 hover:to-emerald-50 transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <app-icon icon="people" size="sm"></app-icon>
              </div>
              <div class="text-left">
                <h3 class="text-base font-bold text-slate-900">Participantes del Proyecto</h3>
                <p class="text-xs text-slate-500 mt-0.5">Docentes, estudiantes y administrativos</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs font-medium" [class.text-emerald-600]="seccionParticipantesExpandida()" [class.text-slate-400]="!seccionParticipantesExpandida()">
                {{ seccionParticipantesExpandida() ? 'Abierta' : 'Cerrada' }}
              </span>
              <app-icon 
                [icon]="seccionParticipantesExpandida() ? 'keyboard_arrow_up' : 'keyboard_arrow_down'" 
                size="md" 
                class="transition-all duration-200"
                [class.text-emerald-600]="seccionParticipantesExpandida()"
                [class.text-slate-400]="!seccionParticipantesExpandida()"></app-icon>
            </div>
          </button>
          
          <!-- Contenido del acordeón -->
          @if (seccionParticipantesExpandida()) {
            <div class="p-6 space-y-6 border-t border-slate-200 animate-fade-in">
          
          <!-- Docentes -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              Docentes
            </label>
            
            <!-- Docentes seleccionados -->
            @if (docentesFormArray.length > 0) {
              <div class="space-y-2 mb-3">
                @for (control of docentesFormArray.controls; track $index) {
                  @let docente = getDocenteById(control.get('id')?.value);
                  @if (docente) {
                    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
                      <div class="flex-1">
                        <p class="text-sm font-medium text-slate-900">{{ docente.nombreCompleto }}</p>
                        <input
                          type="text"
                          [formControl]="$any(control.get('rolEnProyecto'))"
                          placeholder="Rol en el proyecto (opcional)"
                          class="mt-1 w-full px-3 py-1.5 text-xs border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                        />
                      </div>
                      <button
                        type="button"
                        (click)="eliminarDocente($index)"
                        class="p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <app-icon icon="close" size="xs"></app-icon>
                      </button>
                    </div>
                  }
                }
              </div>
            }
            
            <!-- Dropdown de docentes -->
            @if (mostrarDropdownDocente()) {
              <div class="bg-white border-2 border-emerald-200 rounded-lg p-2.5 shadow-lg">
                <input
                  type="text"
                  [value]="terminoBusquedaDocente()"
                  (input)="terminoBusquedaDocente.set($any($event.target).value)"
                  placeholder="Buscar docente..."
                  class="w-full px-3 py-2 text-sm border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none mb-2"
                />
                <div class="max-h-48 overflow-y-auto">
                  @if (filtrarDocentes().length > 0) {
                    <div class="space-y-0.5">
                      @for (docente of filtrarDocentes(); track docente.id) {
                        <button
                          type="button"
                          (click)="agregarDocente(docente)"
                          class="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-emerald-50 hover:text-emerald-700 rounded transition-colors"
                        >
                          {{ docente.nombreCompleto }}
                        </button>
                      }
                    </div>
                  } @else {
                    <p class="text-sm text-slate-500 text-center py-4">No se encontraron docentes</p>
                  }
                </div>
              </div>
            } @else {
              <button
                type="button"
                (click)="mostrarDropdownDocente.set(true)"
                class="w-full px-4 py-2.5 text-sm font-medium text-slate-700 hover:text-emerald-700 hover:bg-emerald-50 border-2 border-dashed border-slate-300 rounded-lg transition-all flex items-center justify-center gap-2"
              >
                <app-icon icon="add" size="xs"></app-icon>
                Agregar Docente
              </button>
            }
          </div>

          <!-- Estudiantes -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              Estudiantes
            </label>
            
            <!-- Estudiantes seleccionados -->
            @if (estudiantesFormArray.length > 0) {
              <div class="space-y-2 mb-3">
                @for (control of estudiantesFormArray.controls; track $index) {
                  @let estudiante = getEstudianteById(control.get('id')?.value);
                  @if (estudiante) {
                    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
                      <div class="flex-1">
                        <p class="text-sm font-medium text-slate-900">{{ estudiante.nombreCompleto }}</p>
                        <input
                          type="text"
                          [formControl]="$any(control.get('rolEnProyecto'))"
                          placeholder="Rol en el proyecto (opcional)"
                          class="mt-1 w-full px-3 py-1.5 text-xs border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                        />
                      </div>
                      <button
                        type="button"
                        (click)="eliminarEstudiante($index)"
                        class="p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <app-icon icon="close" size="xs"></app-icon>
                      </button>
                    </div>
                  }
                }
              </div>
            }
            
            <!-- Dropdown de estudiantes -->
            @if (mostrarDropdownEstudiante()) {
              <div class="bg-white border-2 border-emerald-200 rounded-lg p-2.5 shadow-lg">
                <input
                  type="text"
                  [value]="terminoBusquedaEstudiante()"
                  (input)="terminoBusquedaEstudiante.set($any($event.target).value)"
                  placeholder="Buscar estudiante..."
                  class="w-full px-3 py-2 text-sm border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none mb-2"
                />
                <div class="max-h-48 overflow-y-auto">
                  @if (filtrarEstudiantes().length > 0) {
                    <div class="space-y-0.5">
                      @for (estudiante of filtrarEstudiantes(); track estudiante.id) {
                        <button
                          type="button"
                          (click)="agregarEstudiante(estudiante)"
                          class="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-emerald-50 hover:text-emerald-700 rounded transition-colors"
                        >
                          {{ estudiante.nombreCompleto }}
                        </button>
                      }
                    </div>
                  } @else {
                    <p class="text-sm text-slate-500 text-center py-4">No se encontraron estudiantes</p>
                  }
                </div>
              </div>
            } @else {
              <button
                type="button"
                (click)="mostrarDropdownEstudiante.set(true)"
                class="w-full px-4 py-2.5 text-sm font-medium text-slate-700 hover:text-emerald-700 hover:bg-emerald-50 border-2 border-dashed border-slate-300 rounded-lg transition-all flex items-center justify-center gap-2"
              >
                <app-icon icon="add" size="xs"></app-icon>
                Agregar Estudiante
              </button>
            }
          </div>

          <!-- Administrativos -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              Administrativos
            </label>
            
            <!-- Administrativos seleccionados -->
            @if (administrativosFormArray.length > 0) {
              <div class="space-y-2 mb-3">
                @for (control of administrativosFormArray.controls; track $index) {
                  @let admin = getAdministrativoById(control.get('id')?.value);
                  @if (admin) {
                    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
                      <div class="flex-1">
                        <p class="text-sm font-medium text-slate-900">{{ admin.nombreCompleto }}</p>
                        <input
                          type="text"
                          [formControl]="$any(control.get('rolEnProyecto'))"
                          placeholder="Rol en el proyecto (opcional)"
                          class="mt-1 w-full px-3 py-1.5 text-xs border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                        />
                      </div>
                      <button
                        type="button"
                        (click)="eliminarAdministrativo($index)"
                        class="p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <app-icon icon="close" size="xs"></app-icon>
                      </button>
                    </div>
                  }
                }
              </div>
            }
            
            <!-- Dropdown de administrativos -->
            @if (mostrarDropdownAdministrativo()) {
              <div class="bg-white border-2 border-emerald-200 rounded-lg p-2.5 shadow-lg">
                <input
                  type="text"
                  [value]="terminoBusquedaAdministrativo()"
                  (input)="terminoBusquedaAdministrativo.set($any($event.target).value)"
                  placeholder="Buscar administrativo..."
                  class="w-full px-3 py-2 text-sm border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none mb-2"
                />
                <div class="max-h-48 overflow-y-auto">
                  @if (filtrarAdministrativos().length > 0) {
                    <div class="space-y-0.5">
                      @for (admin of filtrarAdministrativos(); track admin.id) {
                        <button
                          type="button"
                          (click)="agregarAdministrativo(admin)"
                          class="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-emerald-50 hover:text-emerald-700 rounded transition-colors"
                        >
                          {{ admin.nombreCompleto }}
                        </button>
                      }
                    </div>
                  } @else {
                    <p class="text-sm text-slate-500 text-center py-4">No se encontraron administrativos</p>
                  }
                </div>
              </div>
            } @else {
              <button
                type="button"
                (click)="mostrarDropdownAdministrativo.set(true)"
                class="w-full px-4 py-2.5 text-sm font-medium text-slate-700 hover:text-emerald-700 hover:bg-emerald-50 border-2 border-dashed border-slate-300 rounded-lg transition-all flex items-center justify-center gap-2"
              >
                <app-icon icon="add" size="xs"></app-icon>
                Agregar Administrativo
              </button>
            }
          </div>
            </div>
          }
        </div>

        <!-- Sección 4: Documentos -->
        <div class="border border-slate-200 rounded-lg overflow-hidden">
          <!-- Header del acordeón -->
          <button
            type="button"
            (click)="toggleSeccionDocumentos()"
            class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-emerald-50 to-white hover:from-emerald-100 hover:to-emerald-50 transition-all duration-200">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <app-icon icon="attach_file" size="sm"></app-icon>
              </div>
              <div class="text-left">
                <h3 class="text-base font-bold text-slate-900">Documentos</h3>
                <p class="text-xs text-slate-500 mt-0.5">Archivo de soporte del proyecto</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs font-medium" [class.text-emerald-600]="seccionDocumentosExpandida()" [class.text-slate-400]="!seccionDocumentosExpandida()">
                {{ seccionDocumentosExpandida() ? 'Abierta' : 'Cerrada' }}
              </span>
              <app-icon 
                [icon]="seccionDocumentosExpandida() ? 'keyboard_arrow_up' : 'keyboard_arrow_down'" 
                size="md" 
                class="transition-all duration-200"
                [class.text-emerald-600]="seccionDocumentosExpandida()"
                [class.text-slate-400]="!seccionDocumentosExpandida()"></app-icon>
            </div>
          </button>
          
          <!-- Contenido del acordeón -->
          @if (seccionDocumentosExpandida()) {
            <div class="p-6 space-y-6 border-t border-slate-200 animate-fade-in">
              <!-- Archivo de Soporte -->
              <div>
                <label for="archivoSoporte" class="block text-sm font-medium text-slate-700 mb-2 flex items-center gap-2">
                  <app-icon icon="attach_file" size="xs" class="text-emerald-600"></app-icon>
                  Archivo de Soporte
                </label>
                <input
                  id="archivoSoporte"
                  type="file"
                  (change)="onFileSelected($event)"
                  class="w-full px-4 py-2.5 bg-white border-2 border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all"
                  accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                />
                <p class="mt-1.5 text-xs text-slate-500">Formatos permitidos: PDF, DOC, DOCX, JPG, PNG</p>
              </div>
            </div>
          }
        </div>

      </div>

      <!-- Botones de acción -->
      <div class="p-6 pt-0 flex flex-col sm:flex-row gap-3 justify-end">
        <button
          type="button"
          (click)="cancel()"
          class="px-6 py-2.5 border-2 border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 transition-colors font-medium"
          [disabled]="saving()"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="px-6 py-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium disabled:bg-emerald-300 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-sm hover:shadow-md"
          [disabled]="form.invalid || saving()"
        >
          @if (saving()) {
            <div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
            <span>Guardando...</span>
          } @else {
            <app-icon icon="save" size="sm" color="white"></app-icon>
            <span>{{ isEditMode() ? 'Actualizar' : 'Crear' }} Proyecto</span>
          }
        </button>
      </div>

    </form>
  }

</div>

